<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>德國橋牌記分</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* 遊戲狀態管理 */
        .game-state {
            display: none;
        }
        
        .game-state.active {
            display: block;
        }
        
        /* 遊戲設置樣式 */
        .game-setup {
            text-align: center;
            padding: 20px;
        }
        
        .setup-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        
        .player-count-select {
            padding: 10px 15px;
            font-size: 18px;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: white;
        }
        
        .start-game-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .start-game-btn:hover {
            background-color: #229954;
        }
        
        .clear-game-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .clear-game-btn:hover {
            background-color: #c0392b;
        }
        
        /* 叫牌階段樣式 */
        .bidding-phase {
            padding: 20px;
        }
        
        .round-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .current-player {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .bidding-summary {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .bidding-complete-info h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        /* 遊戲流程樣式 */
        .game-flow {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        
        .flow-step {
            padding: 5px 10px;
            margin: 0 5px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .flow-step.current {
            background: #3498db;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        /* 玩家叫牌狀態樣式 */
        .players-bidding-status {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .player-bidding-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }
        
        .player-bidding-card.current {
            border-color: #3498db;
            background: #e3f2fd;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        
        .player-bidding-card h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }
        
        .player-bidding-card .status {
            font-size: 0.9em;
            color: #666;
        }
        
        .player-bidding-card.current .status {
            color: #3498db;
            font-weight: bold;
        }
        
        /* 分數計算樣式 */
        .score-calculation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .score-formula {
            font-size: 0.9em;
            color: #666;
        }
        
        .score-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
        }
        
        /* 分數顯示容器樣式 */
        .scores-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* 按鈕佈局樣式 */
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .clear-game-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .clear-game-btn:hover {
            background-color: #c0392b;
        }
        
        .history-btn {
            background-color: #9b59b6;
            color: white;
        }
        
        .history-btn:hover {
            background-color: #8e44ad;
        }
        
        .next-round-btn {
            background-color: #27ae60;
            color: white;
        }
        
        .next-round-btn:hover {
            background-color: #229954;
        }
        
        /* 數字鍵盤樣式 */
        .number-keypad {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #ddd;
            padding: 15px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            z-index: 1000;
            justify-content: flex-start;
            flex-wrap: nowrap;
        }
        
        .keypad-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .keypad-btn:hover:not(:disabled) {
            background: #3498db;
            color: white;
        }
        
        .keypad-btn:disabled {
            background: #f5f5f5;
            color: #ccc;
            border-color: #ddd;
            cursor: not-allowed;
        }
        
        .keypad-btn.selected {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
        
        .confirm-btn {
            background: #27ae60 !important;
            color: white !important;
            border-color: #27ae60 !important;
            min-width: 80px !important;
        }
        
        .confirm-btn:hover:not(:disabled) {
            background: #229954 !important;
            border-color: #229954 !important;
        }
        
        /* 出牌結果樣式 */
        .trick-results {
            padding: 20px;
        }
        
        .player-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .adjust-buttons {
            display: flex;
            gap: 10px;
        }
        
        .adjust-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .adjust-btn:hover {
            background: #3498db;
            color: white;
        }
        
        /* 分數顯示樣式 */
        .score-display {
            padding: 20px;
        }
        
        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .player-score {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .player-name {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .score-value {
            font-size: 24px;
            color: #3498db;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .history-btn {
            background: #9b59b6;
            color: white;
        }
        
        .history-btn:hover {
            background: #8e44ad;
        }
        
        .next-round-btn {
            background: #27ae60;
            color: white;
        }
        
        .next-round-btn:hover {
            background: #229954;
        }
        
        /* 響應式設計 */
        @media (max-width: 768px) {
            .number-keypad {
                padding: 10px;
            }
            
            .keypad-btn {
                width: 45px;
                height: 45px;
                font-size: 16px;
            }
            
            .score-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
        
        /* 規則按鈕 */
        .rules-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #3498db;
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .rules-button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="show-rules" onclick="window.open('rules.html', '_blank')" class="rules-button">?</button>
        
        <header>
            <h1>德國橋牌記分</h1>
        </header>

        <main>
            <!-- 遊戲設置階段 -->
            <div id="game-setup" class="game-state active">
                <div class="game-setup">
                    <h2>遊戲設置</h2>
                    <div class="setup-controls">
                        <label for="player-count">選擇玩家數量（2-8人）：</label>
                        <select id="player-count" class="player-count-select">
                            <option value="2">2人</option>
                            <option value="3">3人</option>
                            <option value="4" selected>4人</option>
                            <option value="5">5人</option>
                            <option value="6">6人</option>
                            <option value="7">7人</option>
                            <option value="8">8人</option>
                        </select>
                        <button id="start-game" class="start-game-btn">開始遊戲</button>
                        <button id="clear-game" class="clear-game-btn">清除遊戲</button>
                    </div>
                </div>
            </div>

            <!-- 叫牌階段 -->
            <div id="bidding-phase" class="game-state">
                <div class="bidding-phase">
                    <!-- 標題第一行：局數、牌數、花色 -->
                    <div class="round-info">
                        <h2>第<span id="current-round">1</span>回合 每人<span id="cards-per-player">1</span>張牌 王牌花色：<span id="trump-suit">♠</span></h2>
                    </div>
                    
                    <!-- 標題第二行：遊戲流程 -->
                    <div class="game-flow">
                        <span class="flow-step current">叫牌</span> > 
                        <span class="flow-step">出牌結果</span> > 
                        <span class="flow-step">當前分數</span>
                    </div>
                    
                    <!-- 玩家叫牌狀態 -->
                    <div class="players-bidding-status" id="players-bidding-status">
                        <!-- 動態生成玩家狀態 -->
                    </div>
                    
                    <!-- 叫牌完成後的摘要 -->
                    <div class="bidding-summary" id="bidding-summary" style="display: none;">
                        <div class="bidding-complete-info">
                            <h3>叫牌完成</h3>
                            <p>所有玩家已完成叫牌，準備開始出牌</p>
                        </div>
                        <button id="start-playing" class="start-game-btn">開始出牌</button>
                    </div>
                </div>
            </div>

            <!-- 出牌結果階段 -->
            <div id="trick-results" class="game-state">
                <div class="trick-results">
                    <!-- 標題第一行：局數、牌數、花色 -->
                    <div class="round-info">
                        <h2>第<span id="current-round-results">1</span>回合 每人<span id="cards-per-player-results">1</span>張牌 王牌花色：<span id="trump-suit-results">♠</span></h2>
                    </div>
                    
                    <!-- 標題第二行：遊戲流程 -->
                    <div class="game-flow">
                        <span class="flow-step">叫牌</span> > 
                        <span class="flow-step current">出牌結果</span> > 
                        <span class="flow-step">當前分數</span>
                    </div>
                    
                    <div class="results-instruction">
                        <p>請調整實際贏得的墩數</p>
                    </div>
                    <div id="results-list"></div>
                    <button id="calculate-scores" class="start-game-btn">計算分數</button>
                </div>
            </div>

            <!-- 分數顯示階段 -->
            <div id="score-display" class="game-state">
                <div class="score-display">
                    <!-- 標題第一行：局數、牌數、花色 -->
                    <div class="round-info">
                        <h2>第<span id="current-round-scores">1</span>回合 每人<span id="cards-per-player-scores">1</span>張牌 王牌花色：<span id="trump-suit-scores">♠</span></h2>
                    </div>
                    
                    <!-- 標題第二行：遊戲流程 -->
                    <div class="game-flow">
                        <span class="flow-step">叫牌</span> > 
                        <span class="flow-step">出牌結果</span> > 
                        <span class="flow-step current">當前分數</span>
                    </div>
                    
                    <!-- 玩家分數顯示容器 -->
                    <div class="scores-container">
                        <div id="players-score" class="score-grid"></div>
                    </div>
                    
                    <!-- 底部按鈕 -->
                    <div class="action-buttons">
                        <button id="clear-game-from-scores" class="action-btn clear-game-btn">清除遊戲</button>
                        <button id="show-history" class="action-btn history-btn">歷史記錄</button>
                        <button id="next-round" class="action-btn next-round-btn">開始下一局</button>
                    </div>
                </div>
            </div>

            <!-- 歷史記錄彈窗 -->
            <div id="history-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; max-width: 90%; max-height: 80%; overflow-y: auto;">
                    <h3>歷史記錄</h3>
                    <div id="history-list"></div>
                    <button onclick="document.getElementById('history-modal').style.display='none'" class="action-btn" style="margin-top: 15px;">關閉</button>
                </div>
            </div>
        </main>
    </div>

    <!-- 數字鍵盤 -->
    <div id="number-keypad" class="number-keypad" style="display: none;">
        <button class="keypad-btn" data-value="0">0</button>
        <button class="keypad-btn" data-value="1">1</button>
        <button class="keypad-btn" data-value="2">2</button>
        <button class="keypad-btn" data-value="3">3</button>
        <button class="keypad-btn" data-value="4">4</button>
        <button class="keypad-btn" data-value="5">5</button>
        <button class="keypad-btn" data-value="6">6</button>
        <button class="keypad-btn" data-value="7">7</button>
        <button class="keypad-btn" data-value="8">8</button>
        <button class="keypad-btn" data-value="9">9</button>
        <button class="keypad-btn" data-value="10">10</button>
        <button id="confirm-bid" class="keypad-btn confirm-btn">確定</button>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/game.js"></script>
    <script src="test/inline-test.js"></script>
</body>
</html> 