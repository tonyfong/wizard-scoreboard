<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>德國橋牌計分程式 - 簡單功能測試</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .run-all {
            background: #27ae60;
        }
        .run-all:hover {
            background: #229954;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 德國橋牌計分程式 - 簡單功能測試</h1>
        <p>這個測試頁面會在新窗口中打開主遊戲，然後進行功能測試。</p>
        
        <button class="test-button run-all" onclick="openGameAndTest()">🚀 打開遊戲並測試</button>
        <button class="test-button" onclick="runCoreTests()">🔧 運行核心邏輯測試</button>
        <button class="test-button" onclick="clearResults()">🗑️ 清除結果</button>
        
        <div id="test-results"></div>
        
        <div class="test-log" id="test-log">
            <div>測試日誌將在這裡顯示...</div>
        </div>
    </div>

    <script>
        let gameWindow = null;
        
        function log(message, type = 'info') {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            if (type === 'error') {
                logEntry.style.color = '#e74c3c';
            } else if (type === 'success') {
                logEntry.style.color = '#27ae60';
            } else if (type === 'warning') {
                logEntry.style.color = '#f39c12';
            }
            
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function showResult(testName, passed, message) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('test-log').innerHTML = '<div>測試日誌已清除...</div>';
        }
        
        function openGameAndTest() {
            log('🚀 打開主遊戲頁面...');
            
            // 打開主遊戲頁面
            gameWindow = window.open('http://localhost:8000', '_blank');
            
            if (gameWindow) {
                log('✅ 遊戲頁面已打開', 'success');
                log('請在遊戲頁面中進行以下手動測試:', 'warning');
                log('1. 選擇4人遊戲並點擊"開始遊戲"');
                log('2. 完成叫牌流程（選擇數字並點擊確定）');
                log('3. 調整出牌結果');
                log('4. 點擊"計算分數"');
                log('5. 檢查分數是否正確計算');
                log('6. 測試"清除遊戲"功能');
                
                showResult('遊戲頁面', true, '✅ 遊戲頁面已在新窗口中打開');
            } else {
                log('❌ 無法打開遊戲頁面', 'error');
                showResult('遊戲頁面', false, '❌ 無法打開遊戲頁面');
            }
        }
        
        function runCoreTests() {
            log('🔧 開始運行核心邏輯測試...');
            
            // 測試1: 檢查遊戲類是否存在
            try {
                if (typeof Game !== 'undefined') {
                    log('✅ Game類存在', 'success');
                    showResult('Game類', true, '✅ Game類存在');
                } else {
                    log('❌ Game類不存在', 'error');
                    showResult('Game類', false, '❌ Game類不存在');
                }
            } catch (error) {
                log(`❌ 檢查Game類時出錯: ${error.message}`, 'error');
                showResult('Game類', false, `❌ 錯誤: ${error.message}`);
            }
            
            // 測試2: 檢查存儲模組
            try {
                if (typeof storage !== 'undefined') {
                    log('✅ storage模組存在', 'success');
                    showResult('存儲模組', true, '✅ storage模組存在');
                } else {
                    log('❌ storage模組不存在', 'error');
                    showResult('存儲模組', false, '❌ storage模組不存在');
                }
            } catch (error) {
                log(`❌ 檢查storage模組時出錯: ${error.message}`, 'error');
                showResult('存儲模組', false, `❌ 錯誤: ${error.message}`);
            }
            
            // 測試3: 測試牌數計算邏輯
            try {
                // 創建一個臨時的Game實例來測試
                const tempGame = new Game();
                const testCases = [
                    { players: 2, expected: 26 },
                    { players: 4, expected: 13 },
                    { players: 8, expected: 6 }
                ];
                
                let allCorrect = true;
                for (const testCase of testCases) {
                    const result = tempGame.calculateMaxCardsPerPlayer(testCase.players);
                    if (result !== testCase.expected) {
                        allCorrect = false;
                        log(`❌ ${testCase.players}人遊戲牌數錯誤: 期望${testCase.expected}, 實際${result}`, 'error');
                    }
                }
                
                if (allCorrect) {
                    log('✅ 牌數計算邏輯正確', 'success');
                    showResult('牌數計算', true, '✅ 牌數計算邏輯正確');
                } else {
                    log('❌ 牌數計算邏輯錯誤', 'error');
                    showResult('牌數計算', false, '❌ 牌數計算邏輯錯誤');
                }
            } catch (error) {
                log(`❌ 測試牌數計算時出錯: ${error.message}`, 'error');
                showResult('牌數計算', false, `❌ 錯誤: ${error.message}`);
            }
            
            // 測試4: 測試分數計算邏輯
            try {
                const tempGame = new Game();
                
                // 測試Just Make情況
                const justMakeScore = tempGame.calculateScoresInternal([1, 0, 2, 1]);
                if (justMakeScore !== undefined) {
                    log('✅ 分數計算函數存在', 'success');
                    showResult('分數計算', true, '✅ 分數計算函數存在');
                } else {
                    log('❌ 分數計算函數不存在', 'error');
                    showResult('分數計算', false, '❌ 分數計算函數不存在');
                }
            } catch (error) {
                log(`❌ 測試分數計算時出錯: ${error.message}`, 'error');
                showResult('分數計算', false, `❌ 錯誤: ${error.message}`);
            }
            
            log('🔧 核心邏輯測試完成');
        }
        
        // 頁面載入完成後
        document.addEventListener('DOMContentLoaded', function() {
            log('測試頁面已載入，準備就緒。');
        });
    </script>
</body>
</html>
