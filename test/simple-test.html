<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·åœ‹æ©‹ç‰Œè¨ˆåˆ†ç¨‹å¼ - ç°¡å–®åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .run-all {
            background: #27ae60;
        }
        .run-all:hover {
            background: #229954;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª å¾·åœ‹æ©‹ç‰Œè¨ˆåˆ†ç¨‹å¼ - ç°¡å–®åŠŸèƒ½æ¸¬è©¦</h1>
        <p>é€™å€‹æ¸¬è©¦é é¢æœƒåœ¨æ–°çª—å£ä¸­æ‰“é–‹ä¸»éŠæˆ²ï¼Œç„¶å¾Œé€²è¡ŒåŠŸèƒ½æ¸¬è©¦ã€‚</p>
        
        <button class="test-button run-all" onclick="openGameAndTest()">ğŸš€ æ‰“é–‹éŠæˆ²ä¸¦æ¸¬è©¦</button>
        <button class="test-button" onclick="runCoreTests()">ğŸ”§ é‹è¡Œæ ¸å¿ƒé‚è¼¯æ¸¬è©¦</button>
        <button class="test-button" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤çµæœ</button>
        
        <div id="test-results"></div>
        
        <div class="test-log" id="test-log">
            <div>æ¸¬è©¦æ—¥èªŒå°‡åœ¨é€™è£¡é¡¯ç¤º...</div>
        </div>
    </div>

    <script>
        let gameWindow = null;
        
        function log(message, type = 'info') {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            if (type === 'error') {
                logEntry.style.color = '#e74c3c';
            } else if (type === 'success') {
                logEntry.style.color = '#27ae60';
            } else if (type === 'warning') {
                logEntry.style.color = '#f39c12';
            }
            
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function showResult(testName, passed, message) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('test-log').innerHTML = '<div>æ¸¬è©¦æ—¥èªŒå·²æ¸…é™¤...</div>';
        }
        
        function openGameAndTest() {
            log('ğŸš€ æ‰“é–‹ä¸»éŠæˆ²é é¢...');
            
            // æ‰“é–‹ä¸»éŠæˆ²é é¢
            gameWindow = window.open('http://localhost:8000', '_blank');
            
            if (gameWindow) {
                log('âœ… éŠæˆ²é é¢å·²æ‰“é–‹', 'success');
                log('è«‹åœ¨éŠæˆ²é é¢ä¸­é€²è¡Œä»¥ä¸‹æ‰‹å‹•æ¸¬è©¦:', 'warning');
                log('1. é¸æ“‡4äººéŠæˆ²ä¸¦é»æ“Š"é–‹å§‹éŠæˆ²"');
                log('2. å®Œæˆå«ç‰Œæµç¨‹ï¼ˆé¸æ“‡æ•¸å­—ä¸¦é»æ“Šç¢ºå®šï¼‰');
                log('3. èª¿æ•´å‡ºç‰Œçµæœ');
                log('4. é»æ“Š"è¨ˆç®—åˆ†æ•¸"');
                log('5. æª¢æŸ¥åˆ†æ•¸æ˜¯å¦æ­£ç¢ºè¨ˆç®—');
                log('6. æ¸¬è©¦"æ¸…é™¤éŠæˆ²"åŠŸèƒ½');
                
                showResult('éŠæˆ²é é¢', true, 'âœ… éŠæˆ²é é¢å·²åœ¨æ–°çª—å£ä¸­æ‰“é–‹');
            } else {
                log('âŒ ç„¡æ³•æ‰“é–‹éŠæˆ²é é¢', 'error');
                showResult('éŠæˆ²é é¢', false, 'âŒ ç„¡æ³•æ‰“é–‹éŠæˆ²é é¢');
            }
        }
        
        function runCoreTests() {
            log('ğŸ”§ é–‹å§‹é‹è¡Œæ ¸å¿ƒé‚è¼¯æ¸¬è©¦...');
            
            // æ¸¬è©¦1: æª¢æŸ¥éŠæˆ²é¡æ˜¯å¦å­˜åœ¨
            try {
                if (typeof Game !== 'undefined') {
                    log('âœ… Gameé¡å­˜åœ¨', 'success');
                    showResult('Gameé¡', true, 'âœ… Gameé¡å­˜åœ¨');
                } else {
                    log('âŒ Gameé¡ä¸å­˜åœ¨', 'error');
                    showResult('Gameé¡', false, 'âŒ Gameé¡ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`âŒ æª¢æŸ¥Gameé¡æ™‚å‡ºéŒ¯: ${error.message}`, 'error');
                showResult('Gameé¡', false, `âŒ éŒ¯èª¤: ${error.message}`);
            }
            
            // æ¸¬è©¦2: æª¢æŸ¥å­˜å„²æ¨¡çµ„
            try {
                if (typeof storage !== 'undefined') {
                    log('âœ… storageæ¨¡çµ„å­˜åœ¨', 'success');
                    showResult('å­˜å„²æ¨¡çµ„', true, 'âœ… storageæ¨¡çµ„å­˜åœ¨');
                } else {
                    log('âŒ storageæ¨¡çµ„ä¸å­˜åœ¨', 'error');
                    showResult('å­˜å„²æ¨¡çµ„', false, 'âŒ storageæ¨¡çµ„ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`âŒ æª¢æŸ¥storageæ¨¡çµ„æ™‚å‡ºéŒ¯: ${error.message}`, 'error');
                showResult('å­˜å„²æ¨¡çµ„', false, `âŒ éŒ¯èª¤: ${error.message}`);
            }
            
            // æ¸¬è©¦3: æ¸¬è©¦ç‰Œæ•¸è¨ˆç®—é‚è¼¯
            try {
                // å‰µå»ºä¸€å€‹è‡¨æ™‚çš„Gameå¯¦ä¾‹ä¾†æ¸¬è©¦
                const tempGame = new Game();
                const testCases = [
                    { players: 2, expected: 26 },
                    { players: 4, expected: 13 },
                    { players: 8, expected: 6 }
                ];
                
                let allCorrect = true;
                for (const testCase of testCases) {
                    const result = tempGame.calculateMaxCardsPerPlayer(testCase.players);
                    if (result !== testCase.expected) {
                        allCorrect = false;
                        log(`âŒ ${testCase.players}äººéŠæˆ²ç‰Œæ•¸éŒ¯èª¤: æœŸæœ›${testCase.expected}, å¯¦éš›${result}`, 'error');
                    }
                }
                
                if (allCorrect) {
                    log('âœ… ç‰Œæ•¸è¨ˆç®—é‚è¼¯æ­£ç¢º', 'success');
                    showResult('ç‰Œæ•¸è¨ˆç®—', true, 'âœ… ç‰Œæ•¸è¨ˆç®—é‚è¼¯æ­£ç¢º');
                } else {
                    log('âŒ ç‰Œæ•¸è¨ˆç®—é‚è¼¯éŒ¯èª¤', 'error');
                    showResult('ç‰Œæ•¸è¨ˆç®—', false, 'âŒ ç‰Œæ•¸è¨ˆç®—é‚è¼¯éŒ¯èª¤');
                }
            } catch (error) {
                log(`âŒ æ¸¬è©¦ç‰Œæ•¸è¨ˆç®—æ™‚å‡ºéŒ¯: ${error.message}`, 'error');
                showResult('ç‰Œæ•¸è¨ˆç®—', false, `âŒ éŒ¯èª¤: ${error.message}`);
            }
            
            // æ¸¬è©¦4: æ¸¬è©¦åˆ†æ•¸è¨ˆç®—é‚è¼¯
            try {
                const tempGame = new Game();
                
                // æ¸¬è©¦Just Makeæƒ…æ³
                const justMakeScore = tempGame.calculateScoresInternal([1, 0, 2, 1]);
                if (justMakeScore !== undefined) {
                    log('âœ… åˆ†æ•¸è¨ˆç®—å‡½æ•¸å­˜åœ¨', 'success');
                    showResult('åˆ†æ•¸è¨ˆç®—', true, 'âœ… åˆ†æ•¸è¨ˆç®—å‡½æ•¸å­˜åœ¨');
                } else {
                    log('âŒ åˆ†æ•¸è¨ˆç®—å‡½æ•¸ä¸å­˜åœ¨', 'error');
                    showResult('åˆ†æ•¸è¨ˆç®—', false, 'âŒ åˆ†æ•¸è¨ˆç®—å‡½æ•¸ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`âŒ æ¸¬è©¦åˆ†æ•¸è¨ˆç®—æ™‚å‡ºéŒ¯: ${error.message}`, 'error');
                showResult('åˆ†æ•¸è¨ˆç®—', false, `âŒ éŒ¯èª¤: ${error.message}`);
            }
            
            log('ğŸ”§ æ ¸å¿ƒé‚è¼¯æ¸¬è©¦å®Œæˆ');
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œ
        document.addEventListener('DOMContentLoaded', function() {
            log('æ¸¬è©¦é é¢å·²è¼‰å…¥ï¼Œæº–å‚™å°±ç·’ã€‚');
        });
    </script>
</body>
</html>
